<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>rRBC Â· BiGSTARS.jl</title><meta name="title" content="rRBC Â· BiGSTARS.jl"/><meta property="og:title" content="rRBC Â· BiGSTARS.jl"/><meta property="twitter:title" content="rRBC Â· BiGSTARS.jl"/><meta name="description" content="Documentation for BiGSTARS.jl."/><meta property="og:description" content="Documentation for BiGSTARS.jl."/><meta property="twitter:description" content="Documentation for BiGSTARS.jl."/><meta property="og:url" content="https://subhk.github.io/BiGSTARSDocumentation/stable/literated/rRBC/"/><meta property="twitter:url" content="https://subhk.github.io/BiGSTARSDocumentation/stable/literated/rRBC/"/><link rel="canonical" href="https://subhk.github.io/BiGSTARSDocumentation/stable/literated/rRBC/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">BiGSTARS.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../installation_instructions/">Installation instructions</a></li><li><a class="tocitem" href="../../matrices/">Differentiation matrix</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../Stone1971/">Stone1971</a></li><li class="is-active"><a class="tocitem" href>rRBC</a><ul class="internal"><li><a class="tocitem" href="#This-code-finds-critical-Rayleigh-number-for-rotating-Rayleigh-Benrad-Convection-(rRBC)"><span>This code finds critical Rayleigh number for rotating Rayleigh Benrad Convection (rRBC)</span></a></li><li><a class="tocitem" href="#where-the-domain-is-periodic-in-y-direction."><span>where the domain is periodic in y-direction.</span></a></li><li><a class="tocitem" href="#The-code-is-benchmarked-against-Chandrashekar&#39;s-theoretical-results."><span>The code is benchmarked against Chandrashekar&#39;s theoretical results.</span></a></li><li><a class="tocitem" href="#Hydrodynamic-and-hydromagnetic-stability-by-S.-Chandrasekhar,-1961-(page-no-95)"><span>Hydrodynamic and hydromagnetic stability by S. Chandrasekhar, 1961 (page no-95)</span></a></li><li><a class="tocitem" href="#parameter:-Ek-(Ekman-number)-10"><span>parameter: Ek (Ekman number) = 10â»â´</span></a></li><li><a class="tocitem" href="#eigenvalue:-critical-modified-Rayleigh-number-(Raá¶œ)-189.7"><span>eigenvalue: critical modified Rayleigh number (Raá¶œ) = 189.7</span></a></li><li><a class="tocitem" href="#Governing-equations"><span>Governing equations</span></a></li><li><a class="tocitem" href="#Load-required-packages"><span>Load required packages</span></a></li><li><a class="tocitem" href="#Let&#39;s-begin"><span>Let&#39;s begin</span></a></li><li><a class="tocitem" href="#Define-the-grid-and-derivative-operators"><span>Define the grid and derivative operators</span></a></li><li><a class="tocitem" href="#subperscript-with-N&#39;-means-Operator-with-Neumann-boundary-condition"><span>`subperscript with N&#39; means Operator with Neumann boundary condition</span></a></li><li><a class="tocitem" href="#after-kronker-product"><span>after kronker product</span></a></li><li><a class="tocitem" href="#subperscript-with-D&#39;-means-Operator-with-Dirchilet-boundary-condition"><span>`subperscript with D&#39; means Operator with Dirchilet boundary condition</span></a></li><li><a class="tocitem" href="#after-kronker-product-2"><span>after kronker product</span></a></li><li><a class="tocitem" href="#Define-the-parameters"><span>Define the parameters</span></a></li><li><a class="tocitem" href="#Define-the-eigenvalue-solver"><span>Define the eigenvalue solver</span></a></li><li><a class="tocitem" href="#solving-the-rRBC-problem"><span>solving the rRBC problem</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../contributing/">Contributor&#39;s Guide</a></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>rRBC</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>rRBC</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/subhk/BiGSTARS.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ï‚›</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/subhk/BiGSTARS.jl/blob/main/examples/rRBC.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid">ï„</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h2 id="This-code-finds-critical-Rayleigh-number-for-rotating-Rayleigh-Benrad-Convection-(rRBC)"><a class="docs-heading-anchor" href="#This-code-finds-critical-Rayleigh-number-for-rotating-Rayleigh-Benrad-Convection-(rRBC)">This code finds critical Rayleigh number for rotating Rayleigh Benrad Convection (rRBC)</a><a id="This-code-finds-critical-Rayleigh-number-for-rotating-Rayleigh-Benrad-Convection-(rRBC)-1"></a><a class="docs-heading-anchor-permalink" href="#This-code-finds-critical-Rayleigh-number-for-rotating-Rayleigh-Benrad-Convection-(rRBC)" title="Permalink"></a></h2><h2 id="where-the-domain-is-periodic-in-y-direction."><a class="docs-heading-anchor" href="#where-the-domain-is-periodic-in-y-direction.">where the domain is periodic in y-direction.</a><a id="where-the-domain-is-periodic-in-y-direction.-1"></a><a class="docs-heading-anchor-permalink" href="#where-the-domain-is-periodic-in-y-direction." title="Permalink"></a></h2><h2 id="The-code-is-benchmarked-against-Chandrashekar&#39;s-theoretical-results."><a class="docs-heading-anchor" href="#The-code-is-benchmarked-against-Chandrashekar&#39;s-theoretical-results.">The code is benchmarked against Chandrashekar&#39;s theoretical results.</a><a id="The-code-is-benchmarked-against-Chandrashekar&#39;s-theoretical-results.-1"></a><a class="docs-heading-anchor-permalink" href="#The-code-is-benchmarked-against-Chandrashekar&#39;s-theoretical-results." title="Permalink"></a></h2><h2 id="Hydrodynamic-and-hydromagnetic-stability-by-S.-Chandrasekhar,-1961-(page-no-95)"><a class="docs-heading-anchor" href="#Hydrodynamic-and-hydromagnetic-stability-by-S.-Chandrasekhar,-1961-(page-no-95)">Hydrodynamic and hydromagnetic stability by S. Chandrasekhar, 1961 (page no-95)</a><a id="Hydrodynamic-and-hydromagnetic-stability-by-S.-Chandrasekhar,-1961-(page-no-95)-1"></a><a class="docs-heading-anchor-permalink" href="#Hydrodynamic-and-hydromagnetic-stability-by-S.-Chandrasekhar,-1961-(page-no-95)" title="Permalink"></a></h2><h2 id="parameter:-Ek-(Ekman-number)-10"><a class="docs-heading-anchor" href="#parameter:-Ek-(Ekman-number)-10">parameter: Ek (Ekman number) = 10â»â´</a><a id="parameter:-Ek-(Ekman-number)-10-1"></a><a class="docs-heading-anchor-permalink" href="#parameter:-Ek-(Ekman-number)-10" title="Permalink"></a></h2><h2 id="eigenvalue:-critical-modified-Rayleigh-number-(Raá¶œ)-189.7"><a class="docs-heading-anchor" href="#eigenvalue:-critical-modified-Rayleigh-number-(Raá¶œ)-189.7">eigenvalue: critical modified Rayleigh number (Raá¶œ) = 189.7</a><a id="eigenvalue:-critical-modified-Rayleigh-number-(Raá¶œ)-189.7-1"></a><a class="docs-heading-anchor-permalink" href="#eigenvalue:-critical-modified-Rayleigh-number-(Raá¶œ)-189.7" title="Permalink"></a></h2><h2 id="Governing-equations"><a class="docs-heading-anchor" href="#Governing-equations">Governing equations</a><a id="Governing-equations-1"></a><a class="docs-heading-anchor-permalink" href="#Governing-equations" title="Permalink"></a></h2><p>In this module, we do a linear stability analysis of a 2D rotating Rayleigh-Bernard case where the domain is periodic in the <span>$y$</span>-direction, in the <span>$x$</span>-direction is of infinite extent and vertically bounded. The reason to choose this simple case is because we can find an analytical solution for this case. The background temperature profile is given by</p><p class="math-container">\[\overline{\theta} = 1 - z.\]</p><p>The non-dimensional form of the equations governing the perturbation is given by</p><p class="math-container">\[    \frac{E}{Pr} \frac{\partial \mathbf{u}}{\partial t}
    + \hat{z} \times \mathbf{u} =
    -\nabla p + Ra \theta \hat{z} + E \nabla^2 \mathbf{u},\]</p><p class="math-container">\[    \frac{\partial \theta}{\partial t}
    = \mathbf{u} \cdot \hat{z} + \nabla^2 \theta,\]</p><p class="math-container">\[    \nabla \cdot \mathbf{u} = 0,\]</p><p>where <code>E=\nu/(fH^2)</code> is the Ekman number and <code>Ra = g\alpha \Delta T/(f \kappa)</code>, <code>\Delta T</code> is the temperature difference between the bottom and the top walls) is the modified Rayleigh number. By applying the operators <code>(\nabla \times \nabla \times)</code> and <code>(\nabla \times)</code> and taking the <code>z</code>-component of the equations and assuming wave-like perturbations as done previously, we obtained the equations for vertical velocity <code>w^</code>, vertical vorticity <code>\zeta</code> and temperature <code>\theta</code>,</p><p class="math-container">\[\begin{align}
    E \mathcal{D}^4 w - \partial_z \zeta &amp;= -Ra \mathcal{D}_h^2 \theta,
\\
    E \mathcal{D}^2 \zeta + \partial_z w &amp;= 0,
\\
    \mathcal{D}^2 b + w &amp;= 0.
\end{align}\]</p><p>The boundary conditions are:</p><p class="math-container">\[\begin{align}
    w = \partial_z^2 w = \partial_z \zeta = \theta = 0
    \,\,\,\,\,\ \text{at} \,\,\, z=0,1
\end{align}


## Normal mode
Next we consider normal-mode perturbation solutions in the form of (we seek stationary solutions at the marginal state, i.e., ```\sigma = 0```),\]</p><p>math \begin{align}  <a href="x,y,z,t">w, \zeta, \theta</a> = \mathfrak{R}\big(<a href="y, z">\tilde{w}, \tilde{\zeta}, \tilde{\theta}</a>  e^{i kx + \sigma t}\big), \end{align}</p><pre><code class="nohighlight hljs">where the symbol ``\mathfrak{R}`` denotes the real part and a variable with `tilde&#39; denotes an eigenfunction.
Finally following systems of differential equations are obtained,</code></pre><p>math \begin{align}     E \mathcal{D}^4  \tilde{w} - \partial<em>z \tilde{\zeta} &amp;= - Ra \mathcal{D}</em>h^2 \tilde{\theta}, \
    E \mathcal{D}^2 \tilde{\zeta} + \partial_z \tilde{w} &amp;= 0, \
    \mathcal{D}^2 \tilde{\theta} + \tilde{w} &amp;= 0, \end{align}</p><pre><code class="nohighlight hljs">where</code></pre><p>math \begin{align} \mathcal{D}^4  = (\mathcal{D}^2 )^2 = \big(\partial<em>y^2 + \partial</em>z^2 - k^2\big)^2, \,\,\,\, \text{and} \,\, \mathcal{D}<em>h^2 = (\partial</em>y^2 - k^2). \end{align}</p><pre><code class="nohighlight hljs">The eigenfunctions ``\tilde{u}``, ``\tilde{v}`` are related to ``\tilde{w}``, ``\tilde{\zeta}`` by the relations</code></pre><p>math \begin{align}     -\mathcal{D}<em>h^2 \tilde{u} &amp;= i k \partial</em>{z} \tilde{w} + \partial<em>y \tilde{\zeta}, \
    -\mathcal{D}</em>h^2 \tilde{v} &amp;= \partial_{yz} \tilde{w} -  i k \tilde{\zeta}. \end{align}</p><pre><code class="nohighlight hljs">
## Boundary conditions
We choose periodic boundary conditions in the ``y``-direction and free-slip, rigid lid, with zero buoyancy flux in the ``z`` direction, i.e.,</code></pre><p>math \begin{align}     \tilde{w} = \partial<em>{zz} \tilde{w} =     \partial</em>z \tilde{\zeta} = \partial_z \tilde{b} = 0,     \,\,\,\,\,\,\, \text{at} \,\,\, {z}=0, 1. \end{align}</p><pre><code class="nohighlight hljs">
## Generalized eigenvalue problem
The above sets of equations with the boundary conditions can be expressed as a standard generalized eigenvalue problem,</code></pre><p>math \begin{align}     \mathsfit{A} \mathsf{X}= \lambda \mathsfit{B} \mathsf{X}, \end{align} <code>where</code>\lambda=Ra``` is the eigenvalue.</p><h2 id="Load-required-packages"><a class="docs-heading-anchor" href="#Load-required-packages">Load required packages</a><a id="Load-required-packages-1"></a><a class="docs-heading-anchor-permalink" href="#Load-required-packages" title="Permalink"></a></h2><pre><code class="language-julia hljs">using LazyGrids
using LinearAlgebra
using Printf
using StaticArrays
using SparseArrays
using SparseMatrixDicts
using FillArrays
using SpecialFunctions
using Parameters
using Test
using BenchmarkTools

using ArnoldiMethod: partialschur, partialeigen, LR, LI, LM, SR</code></pre><h2 id="Let&#39;s-begin"><a class="docs-heading-anchor" href="#Let&#39;s-begin">Let&#39;s begin</a><a id="Let&#39;s-begin-1"></a><a class="docs-heading-anchor-permalink" href="#Let&#39;s-begin" title="Permalink"></a></h2><pre><code class="language-julia hljs">using BiGSTARS</code></pre><h2 id="Define-the-grid-and-derivative-operators"><a class="docs-heading-anchor" href="#Define-the-grid-and-derivative-operators">Define the grid and derivative operators</a><a id="Define-the-grid-and-derivative-operators-1"></a><a class="docs-heading-anchor-permalink" href="#Define-the-grid-and-derivative-operators" title="Permalink"></a></h2><pre><code class="language-julia hljs">@with_kw mutable struct TwoDimGrid{Ny, Nz}
    y = @SVector zeros(Float64, Ny)
    z = @SVector zeros(Float64, Nz)
end

@with_kw mutable struct ChebMarix{Ny, Nz}
    ğ’ŸÊ¸::Array{Float64,  2}   = SparseMatrixCSC(Zeros(Ny, Ny))
    ğ’ŸÂ²Ê¸::Array{Float64, 2}   = SparseMatrixCSC(Zeros(Ny, Ny))
    ğ’Ÿâ´Ê¸::Array{Float64, 2}   = SparseMatrixCSC(Zeros(Ny, Ny))

    ğ’Ÿá¶»::Array{Float64,  2}   = SparseMatrixCSC(Zeros(Nz, Nz))
    ğ’ŸÂ²á¶»::Array{Float64, 2}   = SparseMatrixCSC(Zeros(Nz, Nz))
    ğ’Ÿâ´á¶»::Array{Float64, 2}   = SparseMatrixCSC(Zeros(Nz, Nz))

    ğ’Ÿá¶»á´º::Array{Float64,  2}  = SparseMatrixCSC(Zeros(Nz, Nz))
    ğ’ŸÂ²á¶»á´º::Array{Float64, 2}  = SparseMatrixCSC(Zeros(Nz, Nz))
    ğ’Ÿâ´á¶»á´º::Array{Float64, 2}  = SparseMatrixCSC(Zeros(Nz, Nz))

    ğ’Ÿá¶»á´°::Array{Float64,  2}  = SparseMatrixCSC(Zeros(Nz, Nz))
    ğ’ŸÂ²á¶»á´°::Array{Float64, 2}  = SparseMatrixCSC(Zeros(Nz, Nz))
    ğ’Ÿâ´á¶»á´°::Array{Float64, 2}  = SparseMatrixCSC(Zeros(Nz, Nz))
end</code></pre><h2 id="subperscript-with-N&#39;-means-Operator-with-Neumann-boundary-condition"><a class="docs-heading-anchor" href="#subperscript-with-N&#39;-means-Operator-with-Neumann-boundary-condition">`subperscript with N&#39; means Operator with Neumann boundary condition</a><a id="subperscript-with-N&#39;-means-Operator-with-Neumann-boundary-condition-1"></a><a class="docs-heading-anchor-permalink" href="#subperscript-with-N&#39;-means-Operator-with-Neumann-boundary-condition" title="Permalink"></a></h2><h2 id="after-kronker-product"><a class="docs-heading-anchor" href="#after-kronker-product">after kronker product</a><a id="after-kronker-product-1"></a><a class="docs-heading-anchor-permalink" href="#after-kronker-product" title="Permalink"></a></h2><h2 id="subperscript-with-D&#39;-means-Operator-with-Dirchilet-boundary-condition"><a class="docs-heading-anchor" href="#subperscript-with-D&#39;-means-Operator-with-Dirchilet-boundary-condition">`subperscript with D&#39; means Operator with Dirchilet boundary condition</a><a id="subperscript-with-D&#39;-means-Operator-with-Dirchilet-boundary-condition-1"></a><a class="docs-heading-anchor-permalink" href="#subperscript-with-D&#39;-means-Operator-with-Dirchilet-boundary-condition" title="Permalink"></a></h2><h2 id="after-kronker-product-2"><a class="docs-heading-anchor" href="#after-kronker-product-2">after kronker product</a><a class="docs-heading-anchor-permalink" href="#after-kronker-product-2" title="Permalink"></a></h2><pre><code class="language-julia hljs">@with_kw mutable struct Operator{N}
    ğ’ŸÊ¸::Array{Float64,  2}   = SparseMatrixCSC(Zeros(N, N))
    ğ’ŸÂ²Ê¸::Array{Float64, 2}   = SparseMatrixCSC(Zeros(N, N))
    ğ’Ÿâ´Ê¸::Array{Float64, 2}   = SparseMatrixCSC(Zeros(N, N))

    ğ’Ÿá¶»::Array{Float64,  2}  = SparseMatrixCSC(Zeros(N, N))
    ğ’ŸÂ²á¶»::Array{Float64, 2}  = SparseMatrixCSC(Zeros(N, N))

    ğ’Ÿá¶»á´º::Array{Float64,  2}  = SparseMatrixCSC(Zeros(N, N))
    ğ’ŸÂ²á¶»á´º::Array{Float64, 2}  = SparseMatrixCSC(Zeros(N, N))
    ğ’Ÿâ´á¶»á´º::Array{Float64, 2}  = SparseMatrixCSC(Zeros(N, N))

    ğ’Ÿá¶»á´°::Array{Float64,  2}  = SparseMatrixCSC(Zeros(N, N))
    ğ’ŸÊ¸á¶»á´°::Array{Float64, 2}  = SparseMatrixCSC(Zeros(N, N))
    ğ’ŸÂ²á¶»á´°::Array{Float64, 2}  = SparseMatrixCSC(Zeros(N, N))
    ğ’Ÿâ´á¶»á´°::Array{Float64, 2}  = SparseMatrixCSC(Zeros(N, N))

    ğ’ŸÊ¸Â²á¶»á´°::Array{Float64,  2}  = SparseMatrixCSC(Zeros(N, N))
    ğ’ŸÂ²Ê¸Â²á¶»á´°::Array{Float64, 2}  = SparseMatrixCSC(Zeros(N, N))
end

function construct_matrices(Op, params)
    N  = params.Ny * params.Nz
    Iâ° = sparse(Matrix(1.0I, N, N)) #Eye{Float64}(N)
    sâ‚ = size(Iâ°, 1); sâ‚‚ = size(Iâ°, 2)

    # allocating memory for the LHS and RHS matrices
    ğ“›â‚ = SparseMatrixCSC(Zeros{Float64}(sâ‚, 3sâ‚‚))
    ğ“›â‚‚ = SparseMatrixCSC(Zeros{Float64}(sâ‚, 3sâ‚‚))
    ğ“›â‚ƒ = SparseMatrixCSC(Zeros{Float64}(sâ‚, 3sâ‚‚))

    â„³â‚ = SparseMatrixCSC(Zeros{Float64}(sâ‚, 3sâ‚‚))
    â„³â‚‚ = SparseMatrixCSC(Zeros{Float64}(sâ‚, 3sâ‚‚))
    â„³â‚ƒ = SparseMatrixCSC(Zeros{Float64}(sâ‚, 3sâ‚‚))

    @printf &quot;Start constructing matrices \n&quot;
    # -------------------- construct matrix  ------------------------
    # lhs of the matrix (size := 3 Ã— 3)
    # eigenvectors: [uá¶» Ï‰á¶» Î¸]áµ€

    âˆ‡â‚•Â² = SparseMatrixCSC(Zeros(N, N))
    âˆ‡â‚•Â² = (1.0 * Op.ğ’ŸÂ²Ê¸ - 1.0 * params.kâ‚“^2 * Iâ°)

    Dâ´ = (1.0 * Op.ğ’Ÿâ´Ê¸ + 1.0 * Op.ğ’Ÿâ´á¶»á´° + 2.0 * Op.ğ’ŸÂ²Ê¸Â²á¶»á´°
        + 1.0 * params.kâ‚“^4 * Iâ°
        - 2.0 * params.kâ‚“^2 * Op.ğ’ŸÂ²Ê¸
        - 2.0 * params.kâ‚“^2 * Op.ğ’ŸÂ²á¶»á´°)

    DÂ²  = 1.0 * Op.ğ’ŸÂ²á¶»á´° + 1.0 * Op.ğ’ŸÂ²Ê¸ - 1.0 * params.kâ‚“^2 * Iâ°
    Dâ‚™Â² = 1.0 * Op.ğ’ŸÂ²á¶»á´º + 1.0 * Op.ğ’ŸÂ²Ê¸ - 1.0 * params.kâ‚“^2 * Iâ°

    # 1. uá¶» (vertical velocity) equation
    ğ“›â‚[:,    1:1sâ‚‚] =  1.0 * params.E * Dâ´
    ğ“›â‚[:,1sâ‚‚+1:2sâ‚‚] = -1.0 * Op.ğ’Ÿá¶»á´º
    ğ“›â‚[:,2sâ‚‚+1:3sâ‚‚] =  0.0 * Iâ°

    # 2. Ï‰á¶» (vertical vorticity) equation
    ğ“›â‚‚[:,    1:1sâ‚‚] = 1.0 * Op.ğ’Ÿá¶»á´°
    ğ“›â‚‚[:,1sâ‚‚+1:2sâ‚‚] = 1.0 * params.E * Dâ‚™Â²
    ğ“›â‚‚[:,2sâ‚‚+1:3sâ‚‚] = 0.0 * Iâ°

    # 3. Î¸ (temperature) equation
    ğ“›â‚ƒ[:,    1:1sâ‚‚] = 1.0 * Iâ°
    ğ“›â‚ƒ[:,1sâ‚‚+1:2sâ‚‚] = 0.0 * Iâ°
    ğ“›â‚ƒ[:,2sâ‚‚+1:3sâ‚‚] = 1.0 * DÂ²

    ğ“› = ([ğ“›â‚; ğ“›â‚‚; ğ“›â‚ƒ]);


    â„³â‚[:,2sâ‚‚+1:3sâ‚‚] = -1.0 * âˆ‡â‚•Â²

    â„³ = ([â„³â‚; â„³â‚‚; â„³â‚ƒ])

    return ğ“›, â„³
end</code></pre><h2 id="Define-the-parameters"><a class="docs-heading-anchor" href="#Define-the-parameters">Define the parameters</a><a id="Define-the-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Define-the-parameters" title="Permalink"></a></h2><pre><code class="language-julia hljs">@with_kw mutable struct Params{T&lt;:Real} @deftype T
    L::T        = 2Ï€          # horizontal domain size
    H::T        = 1.0         # vertical domain size
    Î“::T        = 0.1         # front strength Î“ â‰¡ MÂ²/fÂ² = Î»/H = 1/Îµ â†’ Îµ = 1/Î“
    Îµ::T        = 0.1         # aspect ratio Îµ â‰¡ H/L
    kâ‚“::T       = 0.0         # x-wavenumber
    E::T        = 1.0e-4      # Ekman number
    Ny::Int64   = 180         # no. of y-grid points
    Nz::Int64   = 20          # no. of z-grid points
    method::String   = &quot;arnoldi&quot;
end</code></pre><h2 id="Define-the-eigenvalue-solver"><a class="docs-heading-anchor" href="#Define-the-eigenvalue-solver">Define the eigenvalue solver</a><a id="Define-the-eigenvalue-solver-1"></a><a class="docs-heading-anchor-permalink" href="#Define-the-eigenvalue-solver" title="Permalink"></a></h2><pre><code class="language-julia hljs">function EigSolver(Op, params, Ïƒâ‚€)

    printstyled(&quot;kâ‚“: $(params.kâ‚“) \n&quot;; color=:blue)

    ğ“›, â„³ = construct_matrices(Op,  params)

    N = params.Ny * params.Nz
    MatrixSize = 3N
    @assert size(ğ“›, 1)  == MatrixSize &amp;&amp;
            size(ğ“›, 2)  == MatrixSize &amp;&amp;
            size(â„³, 1)  == MatrixSize &amp;&amp;
            size(â„³, 2)  == MatrixSize &quot;matrix size does not match!&quot;

    if params.method == &quot;shift_invert&quot;

        Î»â‚›, Î§ = EigSolver_shift_invert_arpack( ğ“›, â„³, Ïƒâ‚€=Ïƒâ‚€, maxiter=40, which=:LM)

    elseif params.method == &quot;krylov&quot;

         Î»â‚›, Î§ = EigSolver_shift_invert_krylov( ğ“›, â„³, Ïƒâ‚€=Ïƒâ‚€, maxiter=40, which=:LM)

    elseif params.method == &quot;arnoldi&quot;

        Î»â‚›, Î§ = EigSolver_shift_invert_arnoldi( ğ“›, â„³,
                                            Ïƒâ‚€=0.0,
                                            maxiter=50000,
                                            which=LM())

        Î»â‚›, Î§ = remove_evals(Î»â‚›, Î§, 10.0, 1.0e15, &quot;R&quot;)
        Î»â‚›, Î§ = sort_evals(Î»â‚›, Î§, &quot;R&quot;, &quot;&quot;)

    end

    return Î»â‚›[1] #, Î§[:,1]
end</code></pre><h2 id="solving-the-rRBC-problem"><a class="docs-heading-anchor" href="#solving-the-rRBC-problem">solving the rRBC problem</a><a id="solving-the-rRBC-problem-1"></a><a class="docs-heading-anchor-permalink" href="#solving-the-rRBC-problem" title="Permalink"></a></h2><pre><code class="language-julia hljs">function solve_rRBC(kâ‚“::Float64)
    params      = Params{Float64}(kâ‚“=0.5)
    grid        = TwoDimGrid{params.Ny,  params.Nz}()
    diffMatrix  = ChebMarix{ params.Ny,  params.Nz}()
    Op          = Operator{params.Ny * params.Nz}()
    Construct_DerivativeOperator!(diffMatrix, grid, params)
    ImplementBCs_cheb!(Op, diffMatrix, params)

    Ïƒâ‚€   = 0.0
    params.kâ‚“ = kâ‚“

    Î»â‚› = EigSolver(Op, params, Ïƒâ‚€)

    # Theoretical results from Chandrashekar (1961)
    Î»â‚›â‚œ = 189.7

    return abs(real(Î»â‚›) - Î»â‚›â‚œ)/Î»â‚›â‚œ &lt; 1e-4

end

solve_rRBC(0.0)</code></pre><pre><code class="nohighlight hljs">kâ‚“: 0.0 
Start constructing matrices 
sigma: 0.000000 
Converged: 20 of 20 eigenvalues in 196 matrix-vector products
</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Stone1971/">Â« Stone1971</a><a class="docs-footer-nextpage" href="../../contributing/">Contributor&#39;s Guide Â»</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.13.0 on <span class="colophon-date" title="Wednesday 9 July 2025 14:33">Wednesday 9 July 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
